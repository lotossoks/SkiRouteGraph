# Основные заметки проекта

## План разработки

### 1. Сбор и хранение данных

* Загрузка 200 карт в облако

---

### 2. Разметка исходных изображений

#### 2.1 Структура классов

1. **Дистанция** (701–708)
2. **Лыжни** (801–804)
3. **Рельеф** (101–104)

---

### 3. Подготовка обучающей и тестовой выборок

#### 3.1. Разбиение на патчи

* **Разрезать** каждую карту на 6 неперекрывающихся фрагментов (A4→A7) **до** разделения на train/test, чтобы исключить «зависимость» между группами.
* **Соблюдение границ** карт: все патчи от одной карты попадут либо в train, либо в test .

#### 3.2. Train/Test Split

* 150 исходных карт → все их фрагменты в train.
* 50 карт → фрагменты в test.
* **Валидация**: 20 полноценных карт

---

### 4. Аугментация данных

* **Групповая аугментация** только внутри train и validation (повороты, шумы, масштабирование, изменение яркости).

---

### 5. Выбор и обучение модели сегментации

#### 5.1. Сравнение подходов

* **Классические методы**
* **Нейросети**

#### 5.2. Пайплайн обучения

1. **Даталоадер**: загружать фрагменты и маски, применять аугментацию.
2. **Loss**: комбинированный Cross‑Entropy + Dice Loss для балансировки мелких/крупных объектов.
3. **Метрики**: Mean IoU для каждого класса, глобальный F1
4. **Early Stopping** и **Model Checkpointing**.

---

### 6. Пост‑обработка и построение графа

#### 6.1. Скелетизация и узлы

* **Скелетизация** бинарных масок (Zhang–Suen) → одномерный центр дороги.
* **Детектор узлов**: пиксели с ≠2 соседями → вершины графа.

#### 6.2. Построение взвешенного графа

* **Ребро** = путь между узлами
* **Вес** = длина (метры) + количество пересечений контуров (оценка перепада).

---

### 7. Поиск оптимального маршрута

* **Алгоритмы**: Dijkstra или A★ (с эвристикой по перепаду высот).
* **Проверка**: тестирование на заранее размеченных коротких маршрутах.

---

### 8. Визуализация и API

* **Отрисовка** маршрута как SVG‑оверлей на исходной карте (Leaflet, OpenLayers)

---

## Проблемы

* Проблема с определением направления подъема отрезка

---

## Описание проекта

Проект решает задачу автоматического построения оптимального маршрута прохождения дистанции по карте лыжного ориентирования. На вход подается изображение карты, а на выходе пользователь получает ту же карту с нанесенным маршрутом с учетом типа дорог и рельефа.
